<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸç”Ÿå®¶åº­å¥åº·åº¦æµ‹è¯• - ä½ çš„ç«¥å¹´ä¼¤ç—•æœ‰å¤šæ·±ï¼Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #FFF4E0 0%, #FFE4E1 50%, #E0F8E0 100%);
            min-height: 100vh;
            padding: 15px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            border-radius: 25px;
            padding: 35px 25px;
            box-shadow: 0 15px 50px rgba(255, 179, 71, 0.2);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #FFB347, #90EE90, #FFB347);
        }
        
        .header {
            text-align: center;
            margin-bottom: 35px;
        }
        
        .header h1 {
            font-size: 2.2em;
            margin-bottom: 12px;
            font-weight: bold;
            background: linear-gradient(135deg, #FF8C42 0%, #6BBF59 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            display: inline-block;
        }
        
        .header h1:after {
            content: 'ğŸ ';
            position: absolute;
            right: -35px;
            top: -5px;
            font-size: 0.5em;
        }
        
        .header p {
            color: #666;
            font-size: 1.05em;
            margin-bottom: 8px;
            line-height: 1.6;
        }
        
        .badge {
            display: inline-block;
            background: linear-gradient(135deg, #FFB347 0%, #90EE90 100%);
            color: white;
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 0.85em;
            margin-top: 8px;
            box-shadow: 0 4px 15px rgba(255, 179, 71, 0.3);
        }
        
        .dimensions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        
        .dimension-card {
            background: linear-gradient(135deg, #FFF9F0 0%, #F0FFF0 100%);
            padding: 20px;
            border-radius: 18px;
            text-align: center;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .dimension-card:hover {
            transform: translateY(-5px);
            border-color: #FFB347;
            box-shadow: 0 10px 25px rgba(255, 179, 71, 0.3);
        }
        
        .dimension-icon {
            font-size: 2.5em;
            margin-bottom: 8px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }
        
        .dimension-name {
            color: #FF8C42;
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }
        
        .dimension-desc {
            color: #888;
            font-size: 0.85em;
            line-height: 1.4;
        }
        
        .features-list {
            background: linear-gradient(135deg, #FFF9F0 0%, #F0FFF0 100%);
            padding: 22px;
            border-radius: 18px;
            margin: 25px 0;
            border-left: 4px solid #FFB347;
        }
        
        .features-list h3 {
            color: #FF8C42;
            margin-bottom: 12px;
            font-size: 1.2em;
        }
        
        .features-list ul {
            list-style: none;
            padding-left: 0;
            margin-left: 0;
        }
        
        .features-list li {
            padding: 8px 0;
            padding-left: 0;
            color: #666;
            font-size: 0.95em;
            border-bottom: 1px dashed #FFE4C4;
            transition: padding-left 0.3s;
        }
        
        .features-list li:last-child {
            border-bottom: none;
        }
        
        .features-list li:before {
            content: "ğŸŒ± ";
            margin-right: 8px;
        }
        
        .input-group {
            margin: 25px 0;
        }
        
        .input-group input {
            width: 100%;
            padding: 16px;
            border: 2px solid #FFE4C4;
            border-radius: 15px;
            font-size: 1em;
            text-align: center;
            transition: all 0.3s;
            background: #FAFAFA;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #FFB347;
            background: white;
            box-shadow: 0 0 0 4px rgba(255, 179, 71, 0.15);
        }
        
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 15px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 12px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #FFB347 0%, #90EE90 100%);
            color: white;
            box-shadow: 0 8px 20px rgba(255, 179, 71, 0.4);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(255, 179, 71, 0.5);
        }
        
        .btn-secondary {
            background: white;
            color: #FF8C42;
            border: 2px solid #FFB347;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #FFE4C4;
            border-radius: 10px;
            margin-bottom: 18px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFB347 0%, #90EE90 100%);
            transition: width 0.3s;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(255, 179, 71, 0.5);
        }
        
        .progress-text {
            color: #FF8C42;
            text-align: center;
            font-weight: bold;
            margin-bottom: 25px;
            font-size: 1em;
        }
        
        .question-card {
            background: linear-gradient(135deg, #FFF9F0 0%, #F0FFF0 100%);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 25px;
        }
        
        .question-text {
            color: #333;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .option {
            padding: 15px;
            background: white;
            border: 2px solid #FFE4C4;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
            color: #666;
        }
        
        .option:hover {
            border-color: #FFB347;
            background: #FFF9F0;
            transform: translateX(5px);
        }
        
        .option.selected {
            background: linear-gradient(135deg, #FFB347 0%, #90EE90 100%);
            color: white;
            border-color: #FFB347;
            box-shadow: 0 4px 15px rgba(255, 179, 71, 0.3);
        }
        
        .result-banner {
            background: linear-gradient(135deg, #FF8C42 0%, #6BBF59 100%);
            color: white;
            padding: 35px 25px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
        }
        
        .rpi-score {
            font-size: 3.5em;
            font-weight: bold;
            margin: 18px 0;
            text-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .rpi-level {
            display: inline-block;
            background: rgba(255, 255, 255, 0.25);
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 1.1em;
            backdrop-filter: blur(10px);
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            min-height: 350px;
            margin: 30px 0;
            background: white;
            border-radius: 15px;
            padding: 20px;
        }
        
        .scores-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 25px 0;
        }
        
        .score-item {
            background: linear-gradient(135deg, #FFF9F0 0%, #F0FFF0 100%);
            padding: 18px;
            border-radius: 12px;
            border-left: 4px solid #FFB347;
            transition: transform 0.3s;
        }
        
        .score-item-name {
            color: #FF8C42;
            font-weight: bold;
            margin-bottom: 6px;
            font-size: 0.95em;
        }
        
        .score-item-value {
            font-size: 1.6em;
            color: #333;
            font-weight: bold;
        }
        
        .score-item-desc {
            color: #999;
            font-size: 0.85em;
            margin-top: 4px;
        }
        
        .type-card {
            background: linear-gradient(135deg, #FFF9F0 0%, #F0FFF0 100%);
            padding: 25px;
            border-radius: 18px;
            margin: 25px 0;
            border: 2px solid #FFB347;
        }
        
        .type-card h3 {
            color: #FF8C42;
            font-size: 1.6em;
            margin-bottom: 12px;
        }
        
        .type-card p {
            color: #666;
            line-height: 1.7;
            font-size: 1em;
        }
        
        .characteristics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }
        
        .characteristic-item {
            background: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.3s;
        }
        
        .characteristic-title {
            color: #FF8C42;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        
        .characteristic-list {
            font-size: 0.85em;
            color: #666;
            line-height: 1.5;
        }
        
        .unlock-section {
            background: linear-gradient(135deg, #FFF9F0 0%, #F0FFF0 100%);
            padding: 35px 25px;
            border-radius: 20px;
            margin: 35px 0;
            border: 3px solid #FFB347;
            position: relative;
            overflow: hidden;
        }
        
        .price-tag {
            text-align: center;
            margin: 25px 0;
        }
        
        .original-price {
            text-decoration: line-through;
            color: #999;
            font-size: 1.1em;
        }
        
        .current-price {
            color: #FF6B35;
            font-size: 2.8em;
            font-weight: bold;
            margin: 8px 0;
            text-shadow: 0 2px 4px rgba(255,107,53,0.2);
        }
        
        .price-note {
            color: #666;
            font-size: 0.85em;
            line-height: 1.5;
        }
        
        .admin-link {
            text-align: center;
            margin-top: 25px;
            color: #BBB;
            font-size: 0.85em;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        @media (max-width: 768px) {
            .dimensions-grid {
                grid-template-columns: 1fr;
            }
            .characteristics {
                grid-template-columns: 1fr;
            }
            .scores-list {
                grid-template-columns: 1fr;
            }
            .chart-container {
                height: 350px;
                min-height: 320px;
                padding: 15px;
            }
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="cardVerifyPage" class="card">
            <div class="header">
                <h1>åŸç”Ÿå®¶åº­å¥åº·åº¦æµ‹è¯•</h1>
                <p>ä½ çš„ç«¥å¹´ä¼¤ç—•æœ‰å¤šæ·±ï¼Ÿ</p>
                <p style="font-size: 0.95em; color: #FF8C42;">äº†è§£åŸç”Ÿå®¶åº­å¯¹ä½ çš„å½±å“ ğŸŒ±</p>
                <span class="badge">åŸºäºå¿ƒç†å­¦å®¶åº­ç³»ç»Ÿç†è®ºçš„ä¸“ä¸šè¯„ä¼°</span>
            </div>
            
            <div class="input-group">
                <input type="text" id="cardInput" placeholder="è¯·è¾“å…¥æµ‹è¯„å¡å·" maxlength="20">
            </div>
            
            <button class="btn btn-primary" onclick="verifyCard()">å¼€å§‹æµ‹è¯„ ğŸ </button>
            
            <div class="dimensions-grid" style="margin-top: 30px;">
                <div class="dimension-card">
                    <div class="dimension-icon">ğŸ’</div>
                    <div class="dimension-name">æƒ…æ„Ÿæ”¯æŒåº¦</div>
                    <div class="dimension-desc">çˆ¶æ¯çš„çˆ±ä¸å…³æ€€</div>
                </div>
                <div class="dimension-card">
                    <div class="dimension-icon">ğŸšª</div>
                    <div class="dimension-name">è¾¹ç•Œå¥åº·åº¦</div>
                    <div class="dimension-desc">ä¸ªäººç©ºé—´ä¸å°Šé‡</div>
                </div>
                <div class="dimension-card">
                    <div class="dimension-icon">ğŸ’¬</div>
                    <div class="dimension-name">æ²Ÿé€šæ¨¡å¼</div>
                    <div class="dimension-desc">å®¶åº­å†…éƒ¨äº¤æµ</div>
                </div>
                <div class="dimension-card">
                    <div class="dimension-icon">ğŸ›¡ï¸</div>
                    <div class="dimension-name">å®‰å…¨æ„ŸæŒ‡æ•°</div>
                    <div class="dimension-desc">ç¨³å®šä¸ä¿æŠ¤æ„Ÿ</div>
                </div>
            </div>
            
            <div class="features-list">
                <h3>æµ‹è¯„åŒ…å«</h3>
                <ul>
                    <li>40é¢˜ä¸“ä¸šå¿ƒç†é‡è¡¨</li>
                    <li>4å¤§æ ¸å¿ƒç»´åº¦æ·±åº¦åˆ†æ</li>
                    <li>åŸç”Ÿå®¶åº­å¥åº·åº¦è¯„åˆ†</li>
                    <li><strong style="color:#FF6B35;">å®Œæ•´æ²»æ„ˆæŒ‡å—+æˆé•¿å»ºè®® (Â¥4.9è§£é”)</strong></li>
                </ul>
            </div>
            
            <div class="admin-link" onclick="showAdminPanel()">ç®¡ç†å‘˜å…¥å£ â†’</div>
        </div>
        
        <div id="testPage" class="card hidden">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">ç¬¬1é¢˜ / å…±40é¢˜</div>
            
            <div class="question-card">
                <div class="question-text" id="questionText"></div>
                <div class="options" id="optionsContainer"></div>
            </div>
            
            <div style="display: flex; gap: 12px; margin-top: 20px;">
                <button class="btn btn-secondary" id="prevBtn" onclick="prevQuestion()" style="display: none;">â† ä¸Šä¸€é¢˜</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">ä¸‹ä¸€é¢˜ â†’</button>
            </div>
        </div>
        
        <div id="freeResultPage" class="card hidden">
            <div class="result-banner">
                <h2>ä½ çš„åŸç”Ÿå®¶åº­å¥åº·åº¦æŠ¥å‘Š</h2>
                <p style="font-size: 1.1em; margin-top: 10px; opacity: 0.95;">åŸºç¡€ç‰ˆ</p>
                <div class="rpi-score" id="archetypeIcon">ğŸŒ¤ï¸</div>
                <div class="rpi-level" id="archetypeName">è½»åº¦åˆ›ä¼¤</div>
            </div>
            
            <div class="chart-container">
                <canvas id="radarChart"></canvas>
            </div>
            
            <div class="scores-list" id="scoresList"></div>
            
            <div class="type-card">
                <h3 id="typeName">è½»åº¦åˆ›ä¼¤</h3>
                <p id="typeDesc">ä½ çš„åŸç”Ÿå®¶åº­å­˜åœ¨ä¸€äº›é—®é¢˜,ä½†æ•´ä½“è¿˜ç®—å¥åº·ã€‚è¿™äº›ç»å†å¯¹ä½ æœ‰ä¸€å®šå½±å“,ä½†ä¸è‡³äºé€ æˆä¸¥é‡åˆ›ä¼¤ã€‚</p>
            </div>
            
            <div class="characteristics">
                <div class="characteristic-item">
                    <div class="characteristic-title">ğŸŒ± å½±å“è¡¨ç°</div>
                    <div class="characteristic-list">
                        â€¢ å¶å°”è‡ªæˆ‘æ€€ç–‘<br>
                        â€¢ å…³ç³»ä¸­æœ‰äº›æ•æ„Ÿ<br>
                        â€¢ æƒ…ç»ªå¶å°”æ³¢åŠ¨
                    </div>
                </div>
                <div class="characteristic-item">
                    <div class="characteristic-title">ğŸ’ª æˆé•¿æ–¹å‘</div>
                    <div class="characteristic-list">
                        â€¢ æå‡è‡ªæˆ‘æ¥çº³<br>
                        â€¢ å­¦ä¹ æƒ…ç»ªç®¡ç†<br>
                        â€¢ å»ºç«‹å¥åº·è¾¹ç•Œ
                    </div>
                </div>
                <div class="characteristic-item">
                    <div class="characteristic-title">ğŸŒˆ æ²»æ„ˆå»ºè®®</div>
                    <div class="characteristic-list">
                        â€¢ å¿ƒç†å’¨è¯¢<br>
                        â€¢ é˜…è¯»ç–—æ„ˆä¹¦ç±<br>
                        â€¢ å»ºç«‹æ”¯æŒç³»ç»Ÿ
                    </div>
                </div>
            </div>
            
            <div style="background: linear-gradient(135deg, #FFF9F0 0%, #F0FFF0 100%); padding: 20px; border-radius: 15px; margin: 20px 0; border-left: 4px solid #FFB347;">
                <h4 style="color: #FF8C42; margin-bottom: 12px; font-size: 1.1em;">ğŸŒ± åŸºç¡€å»ºè®®(å…è´¹ç‰ˆ)</h4>
                <ul style="list-style: none; padding-left: 0; line-height: 1.8; color: #666;">
                    <li style="padding: 6px 0;">ğŸ  è®¤è¯†åˆ°:åŸç”Ÿå®¶åº­ä¸æ˜¯ä½ çš„é”™</li>
                    <li style="padding: 6px 0;">ğŸ  æ¥çº³è¿‡å»:ç«¥å¹´æ— æ³•æ”¹å˜,ä½†å¯ä»¥ç–—æ„ˆ</li>
                    <li style="padding: 6px 0;">ğŸ  æ·±åº¦åˆ†æ:ä»˜è´¹ç‰ˆæœ‰å®Œæ•´æ²»æ„ˆæ–¹æ¡ˆ</li>
                </ul>
            </div>
            
            <div class="unlock-section">
                <h3>
                    ä½ çš„<strong style="color: #FF6B35;">åŸºç¡€ç‰ˆ</strong>æŠ¥å‘Šå·²å‡º ğŸŒ±<br>
                    è§£é” <strong style="color: #FF6B35;">å®Œæ•´æ²»æ„ˆæŒ‡å—</strong> å¼€å¯ç–—æ„ˆä¹‹æ—…
                </h3>
                
                <div style="background: white; padding: 20px; border-radius: 15px; margin: 20px 0;">
                    <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px dashed #FFE4C4;">
                        <span style="color: #999;">åŸºç¡€è¯Šæ–­(åˆ†æ•°)</span>
                        <span style="color: #FF6B35; font-weight: bold;">â†’ æ·±åº¦åˆ›ä¼¤åˆ†æ</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px dashed #FFE4C4;">
                        <span style="color: #999;">ç®€å•å»ºè®®(3æ¡)</span>
                        <span style="color: #FF6B35; font-weight: bold;">â†’ ä¸ªæ€§åŒ–æ²»æ„ˆæ–¹æ¡ˆ</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px dashed #FFE4C4;">
                        <span style="color: #999;">æ— å½±å“åˆ†æ</span>
                        <span style="color: #FF6B35; font-weight: bold;">â†’ å½“å‰ç”Ÿæ´»å½±å“è§£æ</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 12px 0;">
                        <span style="color: #999;">æ— ç–—æ„ˆèµ„æº</span>
                        <span style="color: #FF6B35; font-weight: bold;">â†’ ä¹¦ç±+å’¨è¯¢æ¨è</span>
                    </div>
                </div>
                
                <div class="price-tag">
                    <div class="original-price">åŸä»· Â¥29.9</div>
                    <div class="current-price">Â¥4.9</div>
                    <div class="price-note">é™æ—¶ç‰¹æƒ  Â· å¼€å¯ç–—æ„ˆä¹‹æ—… Â· æ‹¥æŠ±å†…åœ¨å°å­©</div>
                </div>
                
                <h4 style="text-align: center; color: #FF8C00; margin: 30px 0 15px 0; font-size: 1.2em;">
                    ğŸ’³ é€‰æ‹©æ”¯ä»˜æ–¹å¼
                </h4>
                
                <div style="max-width: 400px; margin: 0 auto;">
                    <a href="https://qr.alipay.com/tsx15981nt9c4aydmvo2h3d" target="_blank" style="display: flex; align-items: center; justify-content: center; padding: 14px; background: #00A3EE; color: white; text-decoration: none; border-radius: 12px; margin-bottom: 10px; box-shadow: 0 4px 12px rgba(0,163,238,0.3);">
                        <span style="margin-right: 6px;">âš¡</span> æ”¯ä»˜å®å¿«æ·æ”¯ä»˜
                    </a>
                    <button onclick="alert('è¯·ä¿å­˜ä¸‹æ–¹å¾®ä¿¡æ”¶æ¬¾ç ,æ‰“å¼€å¾®ä¿¡æ‰«ç æ”¯ä»˜')" style="width: 100%; display: flex; align-items: center; justify-content: center; padding: 14px; background: #07C160; color: white; border: none; border-radius: 12px; cursor: pointer; box-shadow: 0 4px 12px rgba(7,193,96,0.3); font-size: 1em;">
                        <span style="margin-right: 6px;">âš¡</span> å¾®ä¿¡å¿«æ·æ”¯ä»˜
                    </button>
                    
                    <div style="text-align: center; margin: 20px 0; color: #aaa; font-size: 0.9em;">æˆ–</div>
    
                    <div style="text-align: center; margin: 20px 0;">
                        <p style="color: #666; margin-bottom: 15px; font-size: 1.05em; font-weight: bold;">ğŸ“± æ‰«ç æ”¯ä»˜ Â¥4.9</p>
                        <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                            <div style="text-align: center;">
                                <img src="https://jsh9109.github.io/heian/wechat_qrcode.jpg" 
                                    alt="å¾®ä¿¡æ”¶æ¬¾ç " 
                                    onerror="this.parentElement.style.display='none'" 
                                    style="width: 160px; height: 160px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 3px solid #07C160;">
                                <p style="color: #07C160; font-size: 0.9em; margin-top: 8px; font-weight: bold;">ğŸ’š å¾®ä¿¡æ”¯ä»˜</p>
                            </div>
                            <div style="text-align: center;">
                                <img src="https://jsh9109.github.io/heian/alipay_qrcode.png" 
                                    alt="æ”¯ä»˜å®æ”¶æ¬¾ç " 
                                    onerror="this.parentElement.style.display='none'" 
                                    style="width: 160px; height: 160px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 3px solid #00A3EE;">
                                <p style="color: #00A3EE; font-size: 0.9em; margin-top: 8px; font-weight: bold;">ğŸ’™ æ”¯ä»˜å®æ”¯ä»˜</p>
                            </div>
                        </div>
                        <p style="color: #999; font-size: 0.85em; margin-top: 15px; line-height: 1.6;">
                            ğŸ’¡ é•¿æŒ‰å›¾ç‰‡ä¿å­˜ â†’ æ‰“å¼€å¾®ä¿¡/æ”¯ä»˜å® â†’ æ‰«ä¸€æ‰« â†’ ç›¸å†Œé€‰æ‹©
                        </p>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0; color: #aaa; font-size: 0.9em;">æˆ–</div>
                    
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: #333; font-size: 0.95em;">jsh9109</span>
                        <button onclick="copyToClipboard('jsh9109', this)" style="padding: 8px 14px; background: #FFB347; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.85em;">å¤åˆ¶å¾®ä¿¡</button>
                    </div>
<div style="background: #f8f9fa; padding: 12px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center;">
    <span style="color: #333; font-size: 0.95em;">
         <span>313360631</span><span>@</span><span>qq.com</span>
    </span>
    <button onclick="copyToClipboard('313360631@qq.com', this)" style="padding: 8px 14px; background: #FFB347; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.85em;">å¤åˆ¶æ”¯ä»˜å®</button>
</div>

                    <h4 style="text-align: center; color: #FF8C00; margin: 30px 0 15px 0; font-size: 1.2em;">
                        ğŸ“¸ ä¸Šä¼ ä»˜æ¬¾æˆªå›¾
                    </h4>
                    
                    <label for="paymentProofInput" class="btn btn-primary" style="margin-top: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                        ğŸ“¸ ç‚¹å‡»ä¸Šä¼ æˆªå›¾,ç«‹å³æŸ¥çœ‹å®Œæ•´æŠ¥å‘Š
                    </label>
                    <input type="file" id="paymentProofInput" accept="image/*" onchange="handlePaymentProof(event)" style="display: none;">
                    
                    <div style="text-align: center; margin-top: 18px; padding: 12px; background: rgba(255,179,71,0.1); border-radius: 10px;">
                        <p style="color: #FF8C42; font-size: 0.85em; margin: 0;">
                            ğŸ”’ ä¸Šä¼ æˆªå›¾åç«‹å³è§£é”å®Œæ•´æŠ¥å‘Š,å¼€å¯ç–—æ„ˆä¹‹æ—…
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="fullReportPage" class="card hidden">
            <div style="background: linear-gradient(135deg, #07C160 0%, #05A650 100%); color: white; padding: 20px; border-radius: 15px; text-align: center; margin-bottom: 25px;">
                <h3 style="margin-bottom: 8px; font-size: 1.4em;">âœ… å®Œæ•´æŠ¥å‘Šå·²è§£é”!</h3>
                <p style="font-size: 1em; opacity: 0.95;">æ·±åº¦åˆ†ææŠ¥å‘Šå¦‚ä¸‹,å»ºè®®ä¿å­˜æœ¬é¡µé¢</p>
            </div>
            
            <div class="result-banner">
                <h2>ä½ çš„åŸç”Ÿå®¶åº­å®Œæ•´æŠ¥å‘Š</h2>
                <div class="rpi-score" id="fullFamilyScore">68%</div>
                <div class="rpi-level" id="fullFamilyLevel">è½»åº¦åˆ›ä¼¤ - å¥åº·åº¦68%</div>
            </div>
            
            <div class="chart-container">
                <canvas id="fullRadarChart"></canvas>
            </div>
            
            <div style="background: white; padding: 30px; border-radius: 15px; margin: 25px 0; border-left: 5px solid #FFB347;">
                <h3 style="color: #FF8C42; font-size: 1.6em; margin-bottom: 15px;">ğŸ“‹ ç¬¬ä¸€éƒ¨åˆ†:ä½ çš„å®¶åº­å¥åº·åº¦æ·±åº¦è§£æ</h3>
                <div id="fullAnalysis"></div>
            </div>
            
            <div style="background: white; padding: 30px; border-radius: 15px; margin: 25px 0; border-left: 5px solid #FFB347;">
                <h3 style="color: #FF8C42; font-size: 1.6em; margin-bottom: 15px;">ğŸ’ ç¬¬äºŒéƒ¨åˆ†:ç–—æ„ˆä¸æˆé•¿å»ºè®®</h3>
                
                <h4 style="color: #FF6B35; margin: 20px 0 10px 0;">ğŸŒˆ ç–—æ„ˆçš„ç¬¬ä¸€æ­¥:çœ‹è§ä¸æ¥çº³</h4>
                <div style="background: #FFF9F0; padding: 20px; border-radius: 12px; margin: 15px 0;">
                    <p style="color: #666; line-height: 1.8; margin-bottom: 12px;">
                        <strong style="color: #FF8C42;">1. çœ‹è§ç«¥å¹´çš„è‡ªå·±:</strong>
                        é—­ä¸Šçœ¼ç›,æƒ³è±¡å°æ—¶å€™çš„ä½ ã€‚ä½ åœ¨ç»å†ä»€ä¹ˆ?æ„Ÿå—åˆ°ä»€ä¹ˆ?è¯•ç€å¯¹é‚£ä¸ªå°å­©è¯´:"æˆ‘çœ‹è§ä½ äº†,ä½ å¾ˆå‹‡æ•¢ã€‚"
                    </p>
                    <p style="color: #666; line-height: 1.8; margin-bottom: 12px;">
                        <strong style="color: #FF8C42;">2. æ¥çº³çˆ¶æ¯çš„å±€é™:</strong>
                        çˆ¶æ¯ä¹Ÿæ˜¯æ™®é€šäºº,ä»–ä»¬æœ‰è‡ªå·±çš„åˆ›ä¼¤å’Œå±€é™ã€‚ä»–ä»¬ç»™ä¸äº†ä½ çš„ä¸œè¥¿,å¯èƒ½æ˜¯å› ä¸ºä»–ä»¬è‡ªå·±ä¹Ÿæ²¡æœ‰å¾—åˆ°è¿‡ã€‚
                    </p>
                    <p style="color: #666; line-height: 1.8;">
                        <strong style="color: #FF8C42;">3. å…è®¸è‡ªå·±æ‚²ä¼¤:</strong>
                        ä¸ºç«¥å¹´æ²¡æœ‰å¾—åˆ°çš„çˆ±æ‚²ä¼¤æ˜¯æ­£å¸¸çš„ã€‚ä¸è¦å‹æŠ‘è¿™äº›æƒ…ç»ª,ç»™è‡ªå·±æ—¶é—´å»æ„Ÿå—å’Œé‡Šæ”¾ã€‚
                    </p>
                </div>
                
                <h4 style="color: #FF6B35; margin: 25px 0 10px 0;">ğŸ“… 30å¤©ç–—æ„ˆè®¡åˆ’</h4>
                <div style="background: linear-gradient(135deg, #E0F8E0 0%, #F0FFF0 100%); padding: 20px; border-radius: 12px; margin: 15px 0;">
                    <p style="color: #555; line-height: 1.8; margin-bottom: 12px;">
                        <strong style="color: #6BBF59;">ç¬¬1-10å¤©:è‡ªæˆ‘è§‰å¯Ÿ</strong><br>
                        æ¯å¤©å†™æ—¥è®°,è®°å½•3ä¸ªç«¥å¹´è®°å¿†å’Œå®ƒä»¬å¦‚ä½•å½±å“ç°åœ¨çš„ä½ ã€‚å…è®¸è‡ªå·±å»æ„Ÿå—æƒ…ç»ª,ä¸è¯„åˆ¤ã€‚
                    </p>
                    <p style="color: #555; line-height: 1.8; margin-bottom: 12px;">
                        <strong style="color: #6BBF59;">ç¬¬11-20å¤©:é‡å»ºè‡ªæˆ‘</strong><br>
                        æ¯å¤©å¯¹é•œå­é‡Œçš„è‡ªå·±è¯´3å¥è‚¯å®šçš„è¯ã€‚å¼€å§‹åšä¸€ä»¶è®©ä½ å¿«ä¹çš„äº‹(ç”»ç”»ã€è¿åŠ¨ã€éŸ³ä¹ç­‰)ã€‚
                    </p>
                    <p style="color: #555; line-height: 1.8;">
                        <strong style="color: #6BBF59;">ç¬¬21-30å¤©:å»ºç«‹æ–°æ¨¡å¼</strong><br>
                        åœ¨äººé™…å…³ç³»ä¸­ç»ƒä¹ è®¾ç«‹è¾¹ç•Œã€‚å°è¯•è¡¨è¾¾çœŸå®æ„Ÿå—,å³ä½¿æ„Ÿåˆ°ä¸èˆ’æœã€‚
                    </p>
                </div>
                
                <h4 style="color: #FF6B35; margin: 25px 0 10px 0;">ğŸ“š æ¨èç–—æ„ˆèµ„æº</h4>
                <div style="background: #FFF9F0; padding: 20px; border-radius: 12px; margin: 15px 0;">
                    <p style="color: #666; margin-bottom: 12px;"><strong style="color: #FF8C42;">ğŸ“– å¿…è¯»ä¹¦ç±:</strong></p>
                    <ul style="color: #666; line-height: 2; padding-left: 20px;">
                        <li>ã€ŠåŸç”Ÿå®¶åº­:å¦‚ä½•ä¿®è¡¥è‡ªå·±çš„æ€§æ ¼ç¼ºé™·ã€‹- è‹çŠÂ·ç¦æ²ƒå¾·</li>
                        <li>ã€Šè¢«å¿½è§†çš„å­©å­ã€‹- ä¹”å°¼ä¸Â·éŸ¦å¸ƒ</li>
                        <li>ã€Šèº«ä½“ä»æœªå¿˜è®°ã€‹- è´å¡å°”Â·èŒƒå¾·è€ƒå…‹</li>
                        <li>ã€Šæ‹¥æŠ±ä½ çš„å†…åœ¨å°å­©ã€‹- ä¸€è¡Œç¦…å¸ˆ</li>
                    </ul>
                    
                    <p style="color: #666; margin: 20px 0 12px 0;"><strong style="color: #FF8C42;">ğŸ’¬ ä¸“ä¸šå¸®åŠ©:</strong></p>
                    <ul style="color: #666; line-height: 2; padding-left: 20px;">
                        <li>ç®€å•å¿ƒç†(ä¸“ä¸šå¿ƒç†å’¨è¯¢å¹³å°)</li>
                        <li>å£¹å¿ƒç†(åœ¨çº¿å¿ƒç†æœåŠ¡)</li>
                        <li>æœ¬åœ°åŒ»é™¢å¿ƒç†ç§‘(å¦‚æœ‰ä¸¥é‡å›°æ‰°)</li>
                    </ul>
                </div>
            </div>
            
            <div style="background: white; padding: 30px; border-radius: 15px; margin: 25px 0; border-left: 5px solid #FFB347;">
                <h3 style="color: #FF8C42; font-size: 1.6em; margin-bottom: 15px;">ğŸŒŸ ç¬¬ä¸‰éƒ¨åˆ†:ç»™ä½ çš„è¯</h3>
                
                <div style="background: linear-gradient(135deg, #FFF9F0 0%, #FFE4E1 100%); padding: 25px; border-radius: 12px; margin: 15px 0; border: 2px solid #FFB347;">
                    <p style="color: #666; line-height: 2; font-size: 1.05em; text-align: center;">
                        <strong style="color: #FF6B35; font-size: 1.2em;">ä½ ä¸éœ€è¦"æ²»æ„ˆ",å› ä¸ºä½ ä»æœªç ´ç¢</strong><br><br>
                        åŸç”Ÿå®¶åº­çš„ç»å†å¡‘é€ äº†ä½ ,ä½†ä¸èƒ½å®šä¹‰ä½ ã€‚<br>
                        ä½ æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä¸ªä½“,æœ‰æƒåˆ©è¿‡è‡ªå·±æƒ³è¦çš„ç”Ÿæ´»ã€‚<br><br>
                        ç–—æ„ˆä¸æ˜¯ä¸ºäº†æˆä¸º"æ›´å¥½çš„äºº",<br>
                        è€Œæ˜¯ä¸ºäº†æˆä¸º"çœŸå®çš„è‡ªå·±"ã€‚<br><br>
                        è¯·è®°ä½:<br>
                        <strong style="color: #FF8C42;">ä½ å€¼å¾—è¢«çˆ±,ä½ å€¼å¾—å¹¸ç¦,ä½ å€¼å¾—æ¸©æŸ”ä»¥å¾…ã€‚</strong><br><br>
                        æ— è®ºç«¥å¹´ç»å†äº†ä»€ä¹ˆ,<br>
                        ç°åœ¨çš„ä½ éƒ½å¯ä»¥é€‰æ‹©ç»™è‡ªå·±ä¸€ä¸ªæ‹¥æŠ±,<br>
                        å‘Šè¯‰å†…å¿ƒçš„å°å­©:"æˆ‘ä¼šç…§é¡¾å¥½ä½ ã€‚"
                    </p>
                </div>
            </div>
            
            <div style="background: linear-gradient(135deg, #FFB347 0%, #90EE90 100%); color: white; padding: 25px; border-radius: 15px; text-align: center; margin: 25px 0;">
                <h3 style="margin-bottom: 12px; font-size: 1.4em;">ğŸŒˆ æ„Ÿè°¢ä½ çš„å‹‡æ°”</h3>
                <p style="font-size: 0.95em; opacity: 0.95; line-height: 1.6;">
                    èƒ½å¤Ÿæ­£è§†åŸç”Ÿå®¶åº­é—®é¢˜,è¿™æœ¬èº«å°±éœ€è¦å¾ˆå¤§çš„å‹‡æ°”<br>
                    å»ºè®®ä¿å­˜æœ¬é¡µé¢,åœ¨ç–—æ„ˆè·¯ä¸Šéšæ—¶å›é¡¾<br>
                    ç¥ä½ åœ¨æˆé•¿çš„é“è·¯ä¸Šè¶Šæ¥è¶Šå¥½ ğŸŒ±
                </p>
            </div>
            
            <button class="btn btn-secondary" onclick="location.reload()">é‡æ–°æµ‹è¯„</button>
        </div>
        
        <div id="adminPanel" class="card hidden">
            <h2 style="color: #FF8C42; margin-bottom: 25px; text-align: center;">ğŸ” ç®¡ç†å‘˜åå°</h2>
            
            <div id="adminLogin">
                <div class="input-group">
                    <input type="password" id="adminPassword" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ">
                </div>
                <button class="btn btn-primary" onclick="verifyAdmin()">ç™»å½•</button>
                <button class="btn btn-secondary" onclick="backToMain()">è¿”å›ä¸»é¡µ</button>
            </div>
            
            <div id="adminContent" class="hidden"></div>
        </div>
    </div>
    
    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // ==================== [é…ç½®åŒº] ====================
        const ADMIN_PASSWORD = 'lss900201'; // é»˜è®¤å¯†ç 
        const MASTER_CODE = "FAMILY-MASTER"; // ä¸‡èƒ½å¡å¯†
        // ==================================================
        
        /* 40é“åŸç”Ÿå®¶åº­æµ‹è¯•é¢˜ç›® */
        const questions = [
            /* ç»´åº¦A: æƒ…æ„Ÿæ”¯æŒåº¦ (10é¢˜) */
            {text: 'æˆ‘çš„çˆ¶æ¯ç»å¸¸å¯¹æˆ‘è¯´"æˆ‘çˆ±ä½ "æˆ–ç±»ä¼¼çš„è¯ã€‚', dimension: 0},
            {text: 'å½“æˆ‘éš¾è¿‡æ—¶,çˆ¶æ¯ä¼šå®‰æ…°å’Œå€¾å¬æˆ‘ã€‚', dimension: 0},
            {text: 'æˆ‘è§‰å¾—çˆ¶æ¯çœŸæ­£å…³å¿ƒæˆ‘çš„æ„Ÿå—ã€‚', dimension: 0},
            {text: 'æˆ‘åœ¨å®¶é‡Œæ„Ÿåˆ°è¢«æ¥çº³å’Œè¢«çˆ±ã€‚', dimension: 0},
            {text: 'çˆ¶æ¯å¾ˆå°‘è¡¨è¾¾å¯¹æˆ‘çš„çˆ±å’Œå…³å¿ƒã€‚', dimension: 0, reverse: true},
            {text: 'æˆ‘å¯ä»¥å‘çˆ¶æ¯åˆ†äº«æˆ‘çš„å–œæ€’å“€ä¹ã€‚', dimension: 0},
            {text: 'æˆ‘å¸¸è§‰å¾—è‡ªå·±æ˜¯å®¶é‡Œçš„è´Ÿæ‹…ã€‚', dimension: 0, reverse: true},
            {text: 'çˆ¶æ¯ä¼šè‚¯å®šå’Œèµç¾æˆ‘çš„åŠªåŠ›ã€‚', dimension: 0},
            {text: 'æˆ‘ä»å°å°±è§‰å¾—è‡ªå·±ä¸å¤Ÿå¥½ã€‚', dimension: 0, reverse: true},
            {text: 'å®¶é‡Œæœ‰äººä¼šåœ¨æˆ‘éœ€è¦æ—¶ç»™æˆ‘æ‹¥æŠ±ã€‚', dimension: 0},
            
            /* ç»´åº¦B: è¾¹ç•Œå¥åº·åº¦ (10é¢˜) */
            {text: 'çˆ¶æ¯å°Šé‡æˆ‘çš„éšç§å’Œä¸ªäººç©ºé—´ã€‚', dimension: 1},
            {text: 'çˆ¶æ¯ç»å¸¸ç¿»çœ‹æˆ‘çš„æ—¥è®°ã€æ‰‹æœºæˆ–ç§äººç‰©å“ã€‚', dimension: 1, reverse: true},
            {text: 'æˆ‘å¯ä»¥è‡ªç”±è¡¨è¾¾ä¸çˆ¶æ¯ä¸åŒçš„è§‚ç‚¹ã€‚', dimension: 1},
            {text: 'çˆ¶æ¯æ€»æ˜¯æ›¿æˆ‘åšå†³å®š,ä¸å¾æ±‚æˆ‘çš„æ„è§ã€‚', dimension: 1, reverse: true},
            {text: 'å®¶é‡Œçš„è§„åˆ™æ˜¯åˆç†ä¸”å…¬å¹³çš„ã€‚', dimension: 1},
            {text: 'çˆ¶æ¯ç»å¸¸ç”¨"ä¸ºä½ å¥½"æ§åˆ¶æˆ‘çš„é€‰æ‹©ã€‚', dimension: 1, reverse: true},
            {text: 'æˆ‘æœ‰è‡ªå·±çš„ç‹¬ç«‹ç©ºé—´(æˆ¿é—´æˆ–ç§äººåŒºåŸŸ)ã€‚', dimension: 1},
            {text: 'çˆ¶æ¯ä¼šç”¨æˆ‘çš„ç§˜å¯†å¨èƒæˆ–è¦æŒŸæˆ‘ã€‚', dimension: 1, reverse: true},
            {text: 'çˆ¶æ¯é¼“åŠ±æˆ‘åŸ¹å…»ç‹¬ç«‹æ€è€ƒèƒ½åŠ›ã€‚', dimension: 1},
            {text: 'æˆ‘è§‰å¾—è‡ªå·±åƒçˆ¶æ¯çš„é™„å±å“,è€Œéç‹¬ç«‹ä¸ªä½“ã€‚', dimension: 1, reverse: true},
            
            /* ç»´åº¦C: æ²Ÿé€šæ¨¡å¼ (10é¢˜) */
            {text: 'å®¶é‡Œæœ‰é—®é¢˜æ—¶,æˆ‘ä»¬ä¼šåä¸‹æ¥å¥½å¥½æ²Ÿé€šã€‚', dimension: 2},
            {text: 'çˆ¶æ¯ç»å¸¸å¯¹æˆ‘å¤§å¼å¤§å«ã€‚', dimension: 2, reverse: true},
            {text: 'æˆ‘æ•¢åœ¨çˆ¶æ¯é¢å‰è¡¨è¾¾çœŸå®æƒ³æ³•ã€‚', dimension: 2},
            {text: 'å®¶é‡Œç»å¸¸å†·æˆ˜,è°ä¹Ÿä¸ç†è°ã€‚', dimension: 2, reverse: true},
            {text: 'çˆ¶æ¯ä¼šè®¤çœŸå€¾å¬æˆ‘çš„æ„è§ã€‚', dimension: 2},
            {text: 'çˆ¶æ¯ç»å¸¸è¯´ä¼¤äººçš„è¯(è´¬ä½ã€å˜²è®½)ã€‚', dimension: 2, reverse: true},
            {text: 'æˆ‘ä»¬å®¶èƒ½å¹³å’Œåœ°è§£å†³åˆ†æ­§ã€‚', dimension: 2},
            {text: 'æˆ‘å°æ—¶å€™ç»å¸¸ç›®ç¹çˆ¶æ¯æ¿€çƒˆäº‰åµã€‚', dimension: 2, reverse: true},
            {text: 'çˆ¶æ¯ä¼šå‘æˆ‘é“æ­‰,æ‰¿è®¤è‡ªå·±çš„é”™è¯¯ã€‚', dimension: 2},
            {text: 'æˆ‘åœ¨å®¶é‡Œè¦å°å¿ƒç¿¼ç¿¼,æ€•è¯´é”™è¯ã€‚', dimension: 2, reverse: true},
            
            /* ç»´åº¦D: å®‰å…¨æ„ŸæŒ‡æ•° (10é¢˜) */
            {text: 'æˆ‘å°æ—¶å€™åœ¨å®¶æ„Ÿåˆ°å®‰å…¨å’Œæ”¾æ¾ã€‚', dimension: 3},
            {text: 'æˆ‘ç»å†è¿‡å®¶åº­æš´åŠ›(èº«ä½“æˆ–ç²¾ç¥)ã€‚', dimension: 3, reverse: true},
            {text: 'å®¶é‡Œçš„ç»æµçŠ¶å†µæ¯”è¾ƒç¨³å®šã€‚', dimension: 3},
            {text: 'æˆ‘å°æ—¶å€™ç»å¸¸æ‹…å¿ƒçˆ¶æ¯ä¼šç¦»å©šæˆ–åˆ†å¼€ã€‚', dimension: 3, reverse: true},
            {text: 'æˆ‘ç›¸ä¿¡çˆ¶æ¯ä¼šä¿æŠ¤æˆ‘ã€‚', dimension: 3},
            {text: 'æˆ‘æ›¾ç›®ç¹æˆ–ç»å†è¿‡å®¶åº­æˆå‘˜çš„è‡ªæ€/è‡ªæ®‹è¡Œä¸ºã€‚', dimension: 3, reverse: true},
            {text: 'å®¶é‡Œå¾ˆå°‘å‘ç”Ÿè®©æˆ‘æ„Ÿåˆ°ææƒ§çš„äº‹ã€‚', dimension: 3},
            {text: 'æˆ‘å°æ—¶å€™ç»å¸¸è¢«å¿½è§†æˆ–ç‹¬è‡ªç•™åœ¨å®¶é‡Œã€‚', dimension: 3, reverse: true},
            {text: 'çˆ¶æ¯çš„æƒ…ç»ªæ¯”è¾ƒç¨³å®šå¯é¢„æµ‹ã€‚', dimension: 3},
            {text: 'æˆ‘å°æ—¶å€™ç»å¸¸æ‹…æƒŠå—æ€•,ä¸çŸ¥é“ä¸‹ä¸€åˆ»ä¼šå‘ç”Ÿä»€ä¹ˆã€‚', dimension: 3, reverse: true}
        ];
        
        const options = ['å®Œå…¨ä¸ç¬¦åˆ', 'ä¸å¤ªç¬¦åˆ', 'ä¸ç¡®å®š', 'æ¯”è¾ƒç¬¦åˆ', 'éå¸¸ç¬¦åˆ'];
        
        let currentQuestion = 0;
        let answers = new Array(40).fill(0);
        let currentCard = null;
        
        function getDeviceFingerprint() {
            try {
                let canvasFingerprint = '';
                try {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    if (ctx) {
                        ctx.textBaseline = 'top';
                        ctx.font = '14px Arial';
                        ctx.fillText('fingerprint', 2, 2);
                        canvasFingerprint = canvas.toDataURL().slice(-50);
                    }
                } catch (e) {
                    canvasFingerprint = Date.now().toString();
                }
                
                const fingerprint = [
                    navigator.userAgent || 'unknown',
                    navigator.language || 'unknown',
                    (screen.width || 0) + 'x' + (screen.height || 0),
                    screen.colorDepth || 0,
                    new Date().getTimezoneOffset(),
                    canvasFingerprint
                ].join('|');
                
                let hash = 0;
                for (let i = 0; i < fingerprint.length; i++) {
                    const char = fingerprint.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                
                return 'device_' + Math.abs(hash).toString(36);
            } catch (error) {
                return 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
        }
        
        function verifyCard() {
            const cardInput = document.getElementById('cardInput');
            const cardCode = cardInput.value.trim().toUpperCase();
            
            if (cardCode === MASTER_CODE) {
                currentCard = MASTER_CODE;
                showTestPage(); 
                return;
            }
            
            if (!cardCode) {
                alert('è¯·è¾“å…¥æµ‹è¯„å¡å·');
                return;
            }
            
            if (!/^[A-Z0-9\-]{8,20}$/.test(cardCode)) {
                alert('å¡å·æ ¼å¼ä¸æ­£ç¡®');
                return;
            }
            
            const deviceId = getDeviceFingerprint();
            let cards = JSON.parse(localStorage.getItem('familyCards') || '[]');
            let card = cards.find(c => c.code === cardCode);
            
            if (!card) {
                card = { 
                    code: cardCode, 
                    deviceId: deviceId,
                    createdAt: new Date().toISOString(),
                    firstUsedAt: new Date().toISOString(),
                    testCount: 0
                };
                cards.push(card);
            } else {
                if (card.deviceId && card.deviceId !== deviceId) {
                    alert('è¯¥å¡å·å·²åœ¨å…¶ä»–è®¾å¤‡ä½¿ç”¨');
                    return;
                }
                
                if (!card.deviceId) {
                    card.deviceId = deviceId;
                    card.firstUsedAt = new Date().toISOString();
                }
            }
            
            card.testCount = (card.testCount || 0) + 1;
            card.lastUsedAt = new Date().toISOString();
            
            localStorage.setItem('familyCards', JSON.stringify(cards));
            
            currentCard = card;
            showTestPage();
        }
        
        function showTestPage() {
            document.getElementById('cardVerifyPage').classList.add('hidden');
            document.getElementById('testPage').classList.remove('hidden');
            document.getElementById('fullReportPage').classList.add('hidden');
            document.getElementById('freeResultPage').classList.add('hidden');
            document.getElementById('adminPanel').classList.add('hidden');

            currentQuestion = 0;
            answers = new Array(40).fill(0);
            renderQuestion();
        }
        
        function renderQuestion() {
            const question = questions[currentQuestion];
            document.getElementById('questionText').textContent = `Q${currentQuestion + 1}: ${question.text}`;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                if (answers[currentQuestion] === index + 1) {
                    optionDiv.classList.add('selected');
                }
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectOption(index + 1);
                optionsContainer.appendChild(optionDiv);
            });
            
            const progress = ((currentQuestion + 1) / 40) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `ç¬¬${currentQuestion + 1}é¢˜ / å…±40é¢˜`;
            
            document.getElementById('prevBtn').style.display = currentQuestion > 0 ? 'block' : 'none';
            document.getElementById('nextBtn').textContent = currentQuestion === 39 ? 'å®Œæˆæµ‹è¯„ âœ“' : 'ä¸‹ä¸€é¢˜ â†’';
        }
        
        function selectOption(value) {
            answers[currentQuestion] = value;
            setTimeout(() => {
                if (currentQuestion < 39) {
                    nextQuestion();
                } else {
                    renderQuestion();
                }
            }, 200);
        }
        
        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderQuestion();
            }
        }
        
        function nextQuestion() {
            if (answers[currentQuestion] === 0) {
                alert('è¯·é€‰æ‹©ä¸€ä¸ªé€‰é¡¹');
                return;
            }
            
            if (currentQuestion < 39) {
                currentQuestion++;
                renderQuestion();
            } else {
                calculateResult();
            }
        }
        
        function calculateResult() {
            const dimensionScores = [0, 0, 0, 0];
            const dimensionCounts = [10, 10, 10, 10];
            
            questions.forEach((q, i) => {
                let score = answers[i];
                if (q.reverse) {
                    score = 6 - score;
                }
                dimensionScores[q.dimension] += score;
            });
            
            const finalScores = dimensionScores.map((score, i) => 
                Math.round((score / (dimensionCounts[i] * 5)) * 100)
            );
            
            const totalScore = Math.round(finalScores.reduce((a, b) => a + b, 0) / 4);
            
            let level, icon, desc;
            if (totalScore >= 80) {
                level = 'å¥åº·å®¶åº­';
                icon = 'ğŸŒˆ';
                desc = 'ä½ æ‹¥æœ‰ä¸€ä¸ªæ¸©æš–å¥åº·çš„åŸç”Ÿå®¶åº­,çˆ¶æ¯ç»™äºˆäº†è¶³å¤Ÿçš„çˆ±å’Œæ”¯æŒã€‚è¿™æ˜¯å¾ˆå¹¸è¿çš„,è¯·çæƒœè¿™ä»½å¹¸ç¦ã€‚';
            } else if (totalScore >= 60) {
                level = 'è½»åº¦åˆ›ä¼¤';
                icon = 'ğŸŒ¤ï¸';
                desc = 'ä½ çš„åŸç”Ÿå®¶åº­å­˜åœ¨ä¸€äº›é—®é¢˜,ä½†æ•´ä½“è¿˜ç®—å¥åº·ã€‚è¿™äº›ç»å†å¯¹ä½ æœ‰ä¸€å®šå½±å“,ä½†ä¸è‡³äºé€ æˆä¸¥é‡åˆ›ä¼¤ã€‚';
            } else if (totalScore >= 40) {
                level = 'ä¸­åº¦åˆ›ä¼¤';
                icon = 'â›…';
                desc = 'ä½ çš„åŸç”Ÿå®¶åº­å­˜åœ¨æ˜æ˜¾çš„é—®é¢˜,è¿™äº›ç»å†å¯¹ä½ çš„æˆé•¿äº§ç”Ÿäº†è¾ƒå¤§å½±å“ã€‚å»ºè®®å¯»æ±‚ä¸“ä¸šå¸®åŠ©è¿›è¡Œç–—æ„ˆã€‚';
            } else if (totalScore >= 20) {
                level = 'é‡åº¦åˆ›ä¼¤';
                icon = 'ğŸŒ§ï¸';
                desc = 'ä½ çš„ç«¥å¹´ç»å†äº†è¾ƒä¸ºä¸¥é‡çš„åˆ›ä¼¤,åŸç”Ÿå®¶åº­ç»™ä½ å¸¦æ¥äº†æ·±åˆ»çš„ä¼¤ç—•ã€‚å¼ºçƒˆå»ºè®®å¯»æ±‚å¿ƒç†å’¨è¯¢å¸ˆçš„å¸®åŠ©ã€‚';
            } else {
                level = 'ä¸¥é‡åˆ›ä¼¤';
                icon = 'â›ˆï¸';
                desc = 'ä½ çš„ç«¥å¹´ç»å†äº†ä¸¥é‡çš„åˆ›ä¼¤äº‹ä»¶,è¿™å¯¹ä½ çš„å¿ƒç†å¥åº·äº§ç”Ÿäº†é‡å¤§å½±å“ã€‚è¯·åŠ¡å¿…å¯»æ±‚ä¸“ä¸šçš„å¿ƒç†æ²»ç–—ã€‚';
            }

            sessionStorage.setItem('testResult', JSON.stringify({
                scores: finalScores,
                totalScore: totalScore,
                level: level,
                icon: icon,
                desc: desc
            }));
            
            showFreeResult();
        }
        
        function showFreeResult() {
            const result = JSON.parse(sessionStorage.getItem('testResult'));
            
            document.getElementById('cardVerifyPage').classList.add('hidden');
            document.getElementById('testPage').classList.add('hidden');
            document.getElementById('fullReportPage').classList.add('hidden');
            document.getElementById('freeResultPage').classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('hidden');

            document.getElementById('archetypeIcon').textContent = result.icon;
            document.getElementById('archetypeName').textContent = result.level;
            document.getElementById('typeName').textContent = result.level;
            document.getElementById('typeDesc').textContent = result.desc;
            
            drawRadarChart('radarChart', result.scores);
            
            const scoresList = document.getElementById('scoresList');
            const dimensionNames = ['æƒ…æ„Ÿæ”¯æŒåº¦', 'è¾¹ç•Œå¥åº·åº¦', 'æ²Ÿé€šæ¨¡å¼', 'å®‰å…¨æ„ŸæŒ‡æ•°'];
            const dimensionIcons = ['ğŸ’', 'ğŸšª', 'ğŸ’¬', 'ğŸ›¡ï¸'];
            
            scoresList.innerHTML = '';
            result.scores.forEach((score, i) => {
                const scoreItem = document.createElement('div');
                scoreItem.className = 'score-item';
                scoreItem.innerHTML = `
                    <div class="score-item-name">${dimensionIcons[i]} ${dimensionNames[i]}</div>
                    <div class="score-item-value">${score}%</div>
                    <div class="score-item-desc">${score > 70 ? 'å¥åº·' : score > 50 ? 'ä¸€èˆ¬' : score > 30 ? 'æ¬ ä½³' : 'è¾ƒå·®'}</div>
                `;
                scoresList.appendChild(scoreItem);
            });
            
            window.scrollTo(0, 0);
        }
        
        function drawRadarChart(canvasId, scores) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            const isMobile = window.innerWidth <= 768;
            
            const existingChart = Chart.getChart(canvasId);
            if (existingChart) {
                existingChart.destroy();
            }
            
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['æƒ…æ„Ÿæ”¯æŒåº¦', 'è¾¹ç•Œå¥åº·åº¦', 'æ²Ÿé€šæ¨¡å¼', 'å®‰å…¨æ„ŸæŒ‡æ•°'],
                    datasets: [{
                        label: 'ä½ çš„å¾—åˆ†',
                        data: scores,
                        backgroundColor: 'rgba(255, 179, 71, 0.3)',
                        borderColor: '#FFB347',
                        borderWidth: 3,
                        pointBackgroundColor: '#FF8C42',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: isMobile ? 1 : 1.2,
                    scales: {
                        r: {
                            min: 0,
                            max: 100,
                            ticks: {
                                stepSize: 20,
                                font: {size: isMobile ? 9 : 11}
                            },
                            pointLabels: {
                                font: {size: isMobile ? 10 : 12, weight: 'bold'},
                                color: '#FF8C42'
                            },
                            grid: {color: '#FFE4C4'},
                            angleLines: {color: '#FFE4C4'}
                        }
                    },
                    plugins: {
                        legend: {display: false}
                    }
                }
            });
        }
        
        function handlePaymentProof(event) {
            const file = event.target.files[0];
            
            if (file) {
                setTimeout(() => {
                    alert('âœ… ä»˜æ¬¾æˆªå›¾å·²ä¸Šä¼ !\n\nå®Œæ•´æŠ¥å‘Šå·²è§£é”,è¯·æŸ¥çœ‹ä¸‹æ–¹å†…å®¹ã€‚');
                    showFullReport();
                }, 500);
                
                saveSimpleOrder();
            }
        }
        
        function saveSimpleOrder() {
            const orders = JSON.parse(localStorage.getItem('familyOrders') || '[]');
            orders.unshift({
                id: Date.now(),
                amount: 4.9,
                product: 'åŸç”Ÿå®¶åº­å®Œæ•´æŠ¥å‘Š',
                time: new Date().toISOString(),
                status: 'å·²å®Œæˆ'
            });
            localStorage.setItem('familyOrders', JSON.stringify(orders));
        }
        
        function showFullReport() {
            const result = JSON.parse(sessionStorage.getItem('testResult'));
            
            document.getElementById('cardVerifyPage').classList.add('hidden');
            document.getElementById('testPage').classList.add('hidden');
            document.getElementById('freeResultPage').classList.add('hidden');
            document.getElementById('fullReportPage').classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
            
            document.getElementById('fullFamilyScore').textContent = result.totalScore + '%';
            document.getElementById('fullFamilyLevel').textContent = result.level + ' - å¥åº·åº¦' + result.totalScore + '%';
            
            drawRadarChart('fullRadarChart', result.scores);
            
            const dimensionNames = ['æƒ…æ„Ÿæ”¯æŒåº¦', 'è¾¹ç•Œå¥åº·åº¦', 'æ²Ÿé€šæ¨¡å¼', 'å®‰å…¨æ„ŸæŒ‡æ•°'];
            const lowest = result.scores.indexOf(Math.min(...result.scores));
            
            const analysisTexts = {
                0: 'ä½ åœ¨æƒ…æ„Ÿæ”¯æŒåº¦æ–¹é¢å¾—åˆ†è¾ƒä½,è¯´æ˜ä½ å¯èƒ½åœ¨ç«¥å¹´ç¼ºä¹è¶³å¤Ÿçš„æƒ…æ„Ÿå…³æ€€ã€‚çˆ¶æ¯å¯èƒ½ä¸å¤ªæ“…é•¿è¡¨è¾¾çˆ±,æˆ–è€…ä»–ä»¬å¤ªå¿™ç¢Œè€Œå¿½ç•¥äº†ä½ çš„æƒ…æ„Ÿéœ€æ±‚ã€‚',
                1: 'ä½ åœ¨è¾¹ç•Œå¥åº·åº¦æ–¹é¢å¾—åˆ†è¾ƒä½,è¯´æ˜çˆ¶æ¯å¯èƒ½è¿‡åº¦æ§åˆ¶æˆ–ä¾µçŠ¯ä½ çš„éšç§ã€‚ä½ å¯èƒ½æ„Ÿè§‰æ²¡æœ‰è‡ªå·±çš„ç©ºé—´,æˆ–è€…è¢«å½“ä½œçˆ¶æ¯çš„å»¶ä¼¸è€Œéç‹¬ç«‹ä¸ªä½“ã€‚',
                2: 'ä½ åœ¨æ²Ÿé€šæ¨¡å¼æ–¹é¢å¾—åˆ†è¾ƒä½,è¯´æ˜å®¶åº­å†…éƒ¨æ²Ÿé€šå­˜åœ¨é—®é¢˜ã€‚å¯èƒ½æœ‰å†·æš´åŠ›ã€è¯­è¨€æš´åŠ›,æˆ–è€…æ ¹æœ¬æ— æ³•å¥½å¥½è¯´è¯ã€‚',
                3: 'ä½ åœ¨å®‰å…¨æ„Ÿæ–¹é¢å¾—åˆ†è¾ƒä½,è¯´æ˜ç«¥å¹´ç¯å¢ƒä¸å¤Ÿç¨³å®šå®‰å…¨ã€‚å¯èƒ½ç»å†è¿‡å®¶åº­æš´åŠ›ã€çˆ¶æ¯äº‰åµã€ç»æµå›°éš¾ç­‰è®©ä½ æ„Ÿåˆ°ä¸å®‰çš„äº‹ä»¶ã€‚'
            };
            
            const impactDescriptions = {
                0: {
                    title: 'ğŸ’” æƒ…æ„Ÿç¼ºå¤±çš„å½±å“',
                    items: [
                        'éš¾ä»¥ä¿¡ä»»ä»–äºº,æ€»è§‰å¾—ä¸é…è¢«çˆ±',
                        'åœ¨äº²å¯†å…³ç³»ä¸­è¿‡åº¦ä»˜å‡ºæˆ–è¿‡åº¦å†·æ¼ ',
                        'æƒ…æ„Ÿè¡¨è¾¾å›°éš¾,ä¹ æƒ¯å‹æŠ‘æƒ…ç»ª',
                        'è‡ªæˆ‘ä»·å€¼æ„Ÿä½,éœ€è¦ä¸æ–­å¯»æ±‚å¤–ç•Œè®¤å¯'
                    ]
                },
                1: {
                    title: 'ğŸšª è¾¹ç•Œä¸æ¸…çš„å½±å“',
                    items: [
                        'ä¸æ‡‚æ‹’ç»,æ€»æ˜¯å§”å±ˆè‡ªå·±æˆå…¨ä»–äºº',
                        'æˆ–èµ°å‘å¦ä¸€ä¸ªæç«¯:è¿‡åº¦é˜²å¾¡,éš¾ä»¥äº²è¿‘',
                        'ç¼ºä¹è‡ªæˆ‘è®¤åŒ,å®¹æ˜“è¢«ä»–äººæ„è§å·¦å³',
                        'åœ¨å…³ç³»ä¸­æ‰¾ä¸åˆ°èˆ’é€‚çš„è·ç¦»æ„Ÿ'
                    ]
                },
                2: {
                    title: 'ğŸ’¬ æ²Ÿé€šéšœç¢çš„å½±å“',
                    items: [
                        'ä¹ æƒ¯å†·æš´åŠ›æˆ–æ¿€çƒˆäº‰åµ,ä¸ä¼šå¹³å’Œè¡¨è¾¾',
                        'å®³æ€•å†²çª,å®æ„¿å‹æŠ‘ä¹Ÿä¸æ•¢è¯´å‡ºçœŸå®æƒ³æ³•',
                        'å®¹æ˜“è¯¯è§£ä»–äºº,ä¹Ÿå®¹æ˜“è¢«è¯¯è§£',
                        'åœ¨å…³ç³»ä¸­æ€»æ˜¯"çŒœæ¥çŒœå»",ç¼ºä¹å®‰å…¨æ„Ÿ'
                    ]
                },
                3: {
                    title: 'ğŸ›¡ï¸ ç¼ºä¹å®‰å…¨æ„Ÿçš„å½±å“',
                    items: [
                        'å¯¹æœªæ¥å……æ»¡ç„¦è™‘å’Œä¸ç¡®å®šæ„Ÿ',
                        'åœ¨å…³ç³»ä¸­è¿‡åº¦ä¾èµ–æˆ–è¿‡åº¦ç‹¬ç«‹',
                        'å®¹æ˜“è¢«åˆ›ä¼¤è®°å¿†å›°æ‰°,å‡ºç°æƒ…ç»ªå¤±æ§',
                        'éš¾ä»¥å»ºç«‹ç¨³å®šé•¿ä¹…çš„å…³ç³»'
                    ]
                }
            };
            
            const fullAnalysis = document.getElementById('fullAnalysis');
            if (fullAnalysis) {
                const impactData = impactDescriptions[lowest];
                
                const analysisHTML = `
                    <h4 style="color: #FF6B35; margin: 20px 0 10px 0;">ğŸ  ä½ çš„å®¶åº­ç±»å‹:${result.level}</h4>
                    <p style="color: #666; line-height: 1.8;">
                        ä½ çš„åŸç”Ÿå®¶åº­å¥åº·åº¦ä¸º <strong style="color: #FF6B35;">${result.totalScore}%</strong>,å±äº<strong style="color: #FF6B35;">${result.level}</strong>ç±»å‹ã€‚
                        ${result.desc}
                        <br><br>
                        ä½ çš„æœ€å¤§æŒ‘æˆ˜é¢†åŸŸæ˜¯:<strong style="color: #FF6B35;">${dimensionNames[lowest]}</strong>ã€‚
                        <br>
                        ${analysisTexts[lowest]}
                    </p>
                    
                    <h4 style="color: #FF6B35; margin: 25px 0 10px 0;">ğŸ¯ è¿™å¦‚ä½•å½±å“ä½ çš„ç°åœ¨?</h4>
                    <div style="background: linear-gradient(135deg, #FFF9F0 0%, #FFE4E1 100%); padding: 20px; border-radius: 12px; margin: 15px 0;">
                        <h5 style="color: #FF8C42; margin-bottom: 12px;">${impactData.title}</h5>
                        <ul style="color: #666; line-height: 1.8; padding-left: 20px; margin: 0;">
                            ${impactData.items.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <h4 style="color: #FF6B35; margin: 25px 0 10px 0;">ğŸŒ± å››ä¸ªç»´åº¦è¯¦ç»†åˆ†æ</h4>
                    <div style="display: grid; gap: 15px; margin: 15px 0;">
                        ${result.scores.map((score, i) => `
                            <div style="background: ${i === lowest ? 'linear-gradient(135deg, #FFE4E1 0%, #FFF9F0 100%)' : '#F8F9FA'}; padding: 18px; border-radius: 12px; border-left: 4px solid ${i === lowest ? '#FF6B35' : '#FFB347'};">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <strong style="color: #FF8C42; font-size: 1.1em;">${['ğŸ’', 'ğŸšª', 'ğŸ’¬', 'ğŸ›¡ï¸'][i]} ${dimensionNames[i]}</strong>
                                    <span style="font-size: 1.4em; font-weight: bold; color: ${score > 70 ? '#6BBF59' : score > 50 ? '#FFB347' : '#FF6B35'};">${score}%</span>
                                </div>
                                <p style="color: #666; font-size: 0.95em; line-height: 1.6; margin: 0;">
                                    ${score > 70 ? 'âœ… è¿™ä¸ªç»´åº¦è¡¨ç°è‰¯å¥½,ç»§ç»­ä¿æŒ!' : 
                                      score > 50 ? 'ğŸ“Š è¿™ä¸ªç»´åº¦æœ‰å¾…æå‡,ä½†å¹¶éä¸¥é‡é—®é¢˜ã€‚' :
                                      score > 30 ? 'âš ï¸ è¿™ä¸ªç»´åº¦éœ€è¦é‡ç‚¹å…³æ³¨å’Œç–—æ„ˆã€‚' :
                                      'ğŸš¨ è¿™ä¸ªç»´åº¦å—åˆ›è¾ƒæ·±,å»ºè®®å¯»æ±‚ä¸“ä¸šå¸®åŠ©ã€‚'}
                                </p>
                            </div>
                        `).join('')}
                    </div>
                    
                    <p style="color: #666; line-height: 1.8; margin-top: 20px; padding: 15px; background: #F0FFF0; border-radius: 10px; border-left: 4px solid #6BBF59;">
                        <strong style="color: #6BBF59;">ğŸ’¡ è¯·è®°ä½:</strong> ç«¥å¹´çš„ç»å†ä¸èƒ½å®šä¹‰ä½ ,ä½ å¯ä»¥é€šè¿‡ç–—æ„ˆæˆä¸ºæ›´å¥½çš„è‡ªå·±ã€‚ä¸‹é¢çš„ç–—æ„ˆæŒ‡å—ä¼šå¸®åŠ©ä½ å¼€å¯è¿™æ®µæ—…ç¨‹ã€‚
                    </p>
                `;
                
                fullAnalysis.innerHTML = analysisHTML;
            }
            
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function backToMain() {
            document.getElementById('adminPanel').classList.add('hidden'); 
            document.getElementById('cardVerifyPage').classList.remove('hidden'); 
        }

        function copyToClipboard(text, btn) {
            navigator.clipboard.writeText(text).then(() => {
                const orig = btn.textContent;
                btn.textContent = 'å·²å¤åˆ¶!';
                btn.style.background = '#07C160';
                setTimeout(() => {
                    btn.textContent = orig;
                    btn.style.background = '#FFB347';
                }, 2000);
            });
        }
        
        function showAdminPanel() {
            document.getElementById('cardVerifyPage').classList.add('hidden');
            document.getElementById('adminPanel').classList.remove('hidden');
            
            const loginDiv = document.getElementById('adminLogin');
            if (loginDiv) {
                loginDiv.classList.remove('hidden');
            }
            
            document.getElementById('adminContent').classList.add('hidden');
            document.getElementById('adminPassword').value = '';
        }
        
        function verifyAdmin() {
            const pwd = document.getElementById('adminPassword').value;
            if (pwd === ADMIN_PASSWORD) {
                document.getElementById('adminPassword').value = '';
                
                const loginDiv = document.getElementById('adminLogin');
                if (loginDiv) {
                    loginDiv.classList.add('hidden');
                }
                
                document.getElementById('adminContent').classList.remove('hidden');
                loadAdminStats();
                
                alert('ç™»å½•æˆåŠŸ!');
            } else {
                alert('å¯†ç é”™è¯¯');
                document.getElementById('adminPassword').value = '';
            }
        }
        
        function loadAdminStats() {
            const cards = JSON.parse(localStorage.getItem('familyCards') || '[]');
            const orders = JSON.parse(localStorage.getItem('familyOrders') || '[]');
            
            const total = cards.length;
            const used = cards.filter(c => c.deviceId).length;
            const unused = total - used;
            
            document.getElementById('adminContent').innerHTML = `
                <div style="background: linear-gradient(135deg, #FFF9F0 0%, #F0FFF0 100%); padding: 25px; border-radius: 15px; margin: 25px 0;">
                    <h3 style="color: #FF8C42; margin-bottom: 20px; font-size: 1.4em;">ğŸ“Š æ•°æ®ç»Ÿè®¡</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        <div style="background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                            <div style="font-size: 2.5em; color: #FF8C42; font-weight: bold;">${total}</div>
                            <div style="color: #999; font-size: 0.95em; margin-top: 8px;">å¡å¯†æ€»æ•°</div>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                            <div style="font-size: 2.5em; color: #6BBF59; font-weight: bold;">${used}</div>
                            <div style="color: #999; font-size: 0.95em; margin-top: 8px;">å·²ä½¿ç”¨</div>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                            <div style="font-size: 2.5em; color: #FFB347; font-weight: bold;">${unused}</div>
                            <div style="color: #999; font-size: 0.95em; margin-top: 8px;">æœªä½¿ç”¨</div>
                        </div>
                        <div style="background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                            <div style="font-size: 2.5em; color: #FF6B35; font-weight: bold;">${orders.length}</div>
                            <div style="color: #999; font-size: 0.95em; margin-top: 8px;">ä»˜è´¹è®¢å•</div>
                        </div>
                    </div>
                </div>
                
                <h3 style="color: #FF8C42; margin: 30px 0 15px 0; font-size: 1.3em;">ğŸ’° æœ€è¿‘è®¢å•è®°å½•</h3>
                <div style="background: #FFF9F0; padding: 20px; border-radius: 12px; max-height: 350px; overflow-y: auto;">
                    ${orders.length === 0 ? 
                        '<p style="text-align: center; color: #999; padding: 30px; font-size: 1.05em;">æš‚æ— è®¢å•è®°å½•</p>' :
                        orders.slice(0, 20).map(o => `
                            <div style="background: white; padding: 18px; border-radius: 10px; margin-bottom: 12px; border-left: 4px solid #FFB347;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <div style="font-weight: bold; color: #333; font-size: 1.05em;">Â¥${o.amount} - ${o.product}</div>
                                    <span style="background: #07C160; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.85em;">å·²å®Œæˆ</span>
                                </div>
                                <div style="font-size: 0.9em; color: #999;">${new Date(o.time).toLocaleString('zh-CN')}</div>
                            </div>
                        `).join('')
                    }
                </div>
                
                <h3 style="color: #FF8C42; margin: 30px 0 15px 0; font-size: 1.3em;">ğŸ”‘ ç”Ÿæˆæ–°å¡å¯†</h3>
                <div class="input-group">
                    <input type="number" id="cardCount" placeholder="è¾“å…¥ç”Ÿæˆæ•°é‡(1-100)" min="1" max="100" value="10" style="background: white;">
                </div>
                <button class="btn btn-primary" onclick="generateCards()">ğŸ ç”Ÿæˆå¡å¯†</button>
                
                <h3 style="color: #FF8C42; margin: 30px 0 15px 0; font-size: 1.3em;">ğŸ“‹ æœ€è¿‘ä½¿ç”¨è®°å½•</h3>
                <div style="background: #FFF9F0; padding: 20px; border-radius: 12px; max-height: 300px; overflow-y: auto;">
                    ${cards.filter(c => c.lastUsedAt).length === 0 ? 
                        '<p style="text-align: center; color: #999; padding: 30px;">æš‚æ— ä½¿ç”¨è®°å½•</p>' :
                        cards.filter(c => c.lastUsedAt)
                            .sort((a, b) => new Date(b.lastUsedAt) - new Date(a.lastUsedAt))
                            .slice(0, 10)
                            .map(card => {
                                const date = new Date(card.lastUsedAt);
                                const dateStr = date.toLocaleString('zh-CN');
                                return `
                                    <div style="background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 3px solid #90EE90;">
                                        <div style="font-family: monospace; color: #333; font-weight: bold; margin-bottom: 5px;">${card.code}</div>
                                        <div style="font-size: 0.85em; color: #999;">ä½¿ç”¨ ${card.testCount || 1} æ¬¡ Â· ${dateStr}</div>
                                    </div>
                                `;
                            }).join('')
                    }
                </div>
                
                <button class="btn btn-secondary" onclick="backToMain()" style="margin-top: 25px;">â† è¿”å›ä¸»é¡µ</button>
            `;
        }
        
        function generateCards() {
            const count = parseInt(document.getElementById('cardCount').value);
            
            if (!count || count < 1 || count > 100) {
                alert('è¯·è¾“å…¥1-100ä¹‹é—´çš„æ•°å­—');
                return;
            }
            
            const cards = JSON.parse(localStorage.getItem('familyCards') || '[]');
            const newCards = [];
            
            for (let i = 0; i < count; i++) {
                newCards.push({
                    code: generateCardCode(),
                    createdAt: new Date().toISOString()
                });
            }
            
            cards.push(...newCards);
            localStorage.setItem('familyCards', JSON.stringify(cards));
            
            const text = newCards.map(c => c.code).join('\n');
            const blob = new Blob([text], {type: 'text/plain'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `åŸç”Ÿå®¶åº­æµ‹è¯•å¡å¯†_${new Date().getTime()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert(`æˆåŠŸç”Ÿæˆ${count}ä¸ªå¡å¯†!`);
            loadAdminStats();
        }
        
        function generateCardCode() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let code = 'FAMILY-';
            
            for (let i = 0; i < 4; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            code += '-';
            
            for (let i = 0; i < 4; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            return code;
        }
        
        window.onload = function() {
            const cards = JSON.parse(localStorage.getItem('familyCards') || '[]');
            if (cards.length === 0) {
                const testCards = [];
                for (let i = 0; i < 10; i++) {
                    testCards.push({
                        code: generateCardCode(),
                        createdAt: new Date().toISOString()
                    });
                }
                localStorage.setItem('familyCards', JSON.stringify(testCards));
                console.log('å·²ç”Ÿæˆ10ä¸ªæµ‹è¯•å¡å¯†,è¯·åœ¨ç®¡ç†å‘˜åå°æŸ¥çœ‹(å¯†ç :lss900201)');
            }
        };
    </script>
</body>
</html>
